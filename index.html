<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Exception</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; margin:0; padding:0; background:#121212; color:#fff; }
    header { position:sticky; top:0; background:#1f1f1f; padding:20px; text-align:center; font-size:1.5em; font-weight:bold; border-bottom:2px solid #ff9800; z-index:1000; }
    .container { display:flex; padding:20px; gap:20px; transition:all 0.3s ease; }
    .form-section { width:300px; background:#1e1e1e; padding:20px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.5); transition:all 0.3s ease; }
    .form-section.hidden { display:none; }
    .form-group { margin-bottom:12px; }
    .form-group label { display:block; font-weight:600; margin-bottom:4px; }
    .form-group input { width:100%; padding:8px; border:1px solid #444; border-radius:6px; background:#2c2c2c; color:#fff; }
    .form-group input::placeholder { color:#aaa; }
    .form-actions { display:flex; gap:10px; margin-top:10px; }
    .form-actions button, .controls button { padding:8px 16px; border:none; border-radius:6px; background:#ff9800; color:white; cursor:pointer; font-weight:600; }
    .form-actions button:hover, .controls button:hover { background:#e68900; }
    .controls { text-align:right; margin-bottom:10px; }
    .controls button { padding:6px 10px; font-size:0.8em; }
    .table-section { flex:1; padding:20px; background:#1e1e1e; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.5); transition:all 0.3s ease; }
    table { width:100%; border-collapse:collapse; background:#1e1e1e; color:#fff; font-size:0.85em; }
    th, td { border:1px solid #fff; padding:6px 8px; text-align:left; font-weight:normal; }
    th { background:linear-gradient(135deg, #ff9800, #ffb74d); color:#000; font-weight:600; }
    .action-btns button { margin-right:4px; padding:4px 6px; border:none; border-radius:4px; font-size:1.1em; cursor:pointer; background:transparent; }
    .action-btns button.edit { color:#4caf50; } .action-btns button.view { color:#2196f3; } 
    .action-btns button.download { color:#ffeb3b; } .action-btns button.delete { color:#f44336; }
    .toggle-btn { position:fixed; top:20px; left:20px; background:#444; color:white; border:none; padding:6px 12px; border-radius:4px; cursor:pointer; z-index:1001; }
    .modal { display:none; position:fixed; z-index:2000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center; }
    .modal-content { background:#2c2c2c; padding:20px; border-radius:8px; text-align:center; }
    .modal-content h3 { margin-top:0; margin-bottom:10px; }
    .modal-content button { margin:5px; padding:8px 12px; border:none; border-radius:6px; cursor:pointer; font-weight:600; }
    .modal-content button.quot { background:#2196f3; color:#fff; }
    .modal-content button.far { background:#9c27b0; color:#fff; }
    .modal-content button.ccr { background:#ff5722; color:#fff; }
    .modal-content button.close { background:#555; color:#fff; }
  </style>
</head>
<body>

<header>üìã Exception/header>
<button class="toggle-btn" onclick="toggleForm()">‚ò∞</button>

<div class="container">
  <div class="form-section" id="formPanel">
    <h2>Tambah / Edit Data</h2>
    <div class="form-group"><label>Room</label><input id="room" type="text"></div>
    <div class="form-group"><label>Model</label><input id="model" type="text"></div>
    <div class="form-group"><label>Order Number</label><input id="order" type="text"></div>
    <div class="form-group"><label>Short Text</label><input id="shortText" type="text"></div>
    <div class="form-group"><label>Vendor</label><input id="vendor" type="text"></div>
    <div class="form-group"><label>No Quot</label><input id="noQuot" type="text"></div>
    <div class="form-group"><label>Quot (PDF/PNG)</label><input id="quotFile" type="file" accept=".pdf,.png"></div>
    <div class="form-group"><label>FAR (PDF/PNG)</label><input id="farFile" type="file" accept=".pdf,.png"></div>
    <div class="form-group"><label>CCR (PDF/PNG)</label><input id="ccrFile" type="file" accept=".pdf,.png"></div>
    <div class="form-group"><label>PR</label><input id="pr" type="text"></div>
    <div class="form-group"><label>PO</label><input id="po" type="text"></div>
    <div class="form-group"><label>SOW</label><input id="sow" type="text"></div>
    <div class="form-group"><label>SES</label><input id="ses" type="text"></div>
    <div class="form-actions">
      <button onclick="addData()">Save</button>
      <button onclick="resetForm()">Reset</button>
    </div>
  </div>

  <div class="table-section">
    <div class="controls">
      <button onclick="saveJSON()">üíæ Save JSON</button>
      <input type="file" accept=".json" onchange="loadJSON(event)">
    </div>
    <table id="dataTable">
      <thead>
        <tr>
          <th>Room</th><th>Model</th><th>Order</th><th>Short Text</th><th>Vendor</th><th>No Quot</th>
          <th>Quot</th><th>FAR</th><th>CCR</th><th>PR</th><th>PO</th><th>SOW</th><th>SES</th><th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div class="modal" id="fileModal">
  <div class="modal-content">
    <h3>Pilih file untuk dilihat</h3>
    <div id="fileButtons"></div>
    <button class="close" onclick="closeModal()">Tutup</button>
  </div>
</div>

<script>
  let jobData = [];

  function toggleForm() {
    document.getElementById("formPanel").classList.toggle("hidden");
  }

  function addData() {
    const data = {
      room: getVal("room"), model: getVal("model"), order: getVal("order"),
      shortText: getVal("shortText"), vendor: getVal("vendor"), noQuot: getVal("noQuot"),
      pr: getVal("pr"), po: getVal("po"), sow: getVal("sow"), ses: getVal("ses")
    };
    Promise.all([
      fileToBase64("quotFile"), fileToBase64("farFile"), fileToBase64("ccrFile")
    ]).then(([quot, far, ccr]) => {
      data.quotFile = quot;
      data.farFile = far;
      data.ccrFile = ccr;
      jobData.push(data);
      renderTable();
      resetForm();
    });
  }

  function getVal(id){ return document.getElementById(id).value; }

  function fileToBase64(id){
    const file = document.getElementById(id).files[0];
    return new Promise(resolve=>{
      if(!file){ resolve(null); return; }
      const reader = new FileReader();
      reader.onload = ()=> resolve({ name:file.name, type:file.type, data:reader.result });
      reader.readAsDataURL(file);
    });
  }

  function base64ToFile(obj){
    if(!obj) return null;
    const arr = obj.data.split(","), mime = arr[0].match(/:(.*?);/)[1];
    const bstr = atob(arr[1]); let n = bstr.length; const u8arr = new Uint8Array(n);
    while(n--){ u8arr[n] = bstr.charCodeAt(n); }
    return new File([u8arr], obj.name, { type: mime });
  }

  function resetForm(){ document.querySelectorAll(".form-group input").forEach(i=>i.value=""); }

  function renderTable() {
    const tbody = document.querySelector("#dataTable tbody"); tbody.innerHTML="";
    jobData.forEach((item,i)=>{
      const row=document.createElement("tr");
      row.innerHTML=`
        <td>${item.room}</td><td>${item.model}</td><td>${item.order}</td><td>${item.shortText}</td>
        <td>${item.vendor}</td><td>${item.noQuot}</td><td>${item.quotFile?.name || '-'}</td>
        <td>${item.farFile?.name || '-'}</td><td>${item.ccrFile?.name || '-'}</td>
        <td>${item.pr}</td><td>${item.po}</td><td>${item.sow}</td><td>${item.ses}</td>
        <td class="action-btns">
          <button class="edit" onclick="editData(${i})">‚úè</button>
          <button class="view" onclick="viewFiles(${i})">üëÅ</button>
          <button class="download" onclick="downloadFiles(${i})">‚¨á</button>
          <button class="delete" onclick="deleteData(${i})">‚ùå</button>
        </td>`;
      tbody.appendChild(row);
    });
  }

  function editData(i){ const item=jobData[i];
    document.getElementById("room").value=item.room;
    document.getElementById("model").value=item.model;
    document.getElementById("order").value=item.order;
    document.getElementById("shortText").value=item.shortText;
    document.getElementById("vendor").value=item.vendor;
    document.getElementById("noQuot").value=item.noQuot;
    document.getElementById("pr").value=item.pr;
    document.getElementById("po").value=item.po;
    document.getElementById("sow").value=item.sow;
    document.getElementById("ses").value=item.ses;
    jobData.splice(i,1); renderTable();
  }

  function viewFiles(i){
    const item=jobData[i];
    const files=[
      {label:"Quot",file:base64ToFile(item.quotFile),cls:"quot"},
      {label:"FAR",file:base64ToFile(item.farFile),cls:"far"},
      {label:"CCR",file:base64ToFile(item.ccrFile),cls:"ccr"}
    ].filter(f=>f.file);
    if(!files.length){ alert("Tidak ada file untuk dilihat."); return; }
    const cont=document.getElementById("fileButtons"); cont.innerHTML="";
    files.forEach(f=>{
      const btn=document.createElement("button");
      btn.textContent=f.label; btn.className=f.cls;
      btn.onclick=()=>window.open(URL.createObjectURL(f.file),"_blank");
      cont.appendChild(btn);
    });
    document.getElementById("fileModal").style.display="flex";
  }

  function closeModal(){ document.getElementById("fileModal").style.display="none"; }

  function downloadFiles(i){
    [base64ToFile(jobData[i].quotFile), base64ToFile(jobData[i].farFile), base64ToFile(jobData[i].ccrFile)]
      .forEach(file=>{
        if(file){ const link=document.createElement("a");
          link.href=URL.createObjectURL(file); link.download=file.name;
          document.body.appendChild(link); link.click(); document.body.removeChild(link);
        }
      });
  }

  function deleteData(i){ jobData.splice(i,1); renderTable(); }

  function saveJSON(){
    const blob=new Blob([JSON.stringify(jobData,null,2)],{type:"application/json"});
    const link=document.createElement("a"); link.href=URL.createObjectURL(blob);
    link.download="jobflow_data.json"; link.click();
  }

  function loadJSON(e){
    const file=e.target.files[0]; if(!file) return;
    const reader=new FileReader();
    reader.onload=function(ev){ jobData=JSON.parse(ev.target.result); renderTable(); };
    reader.readAsText(file);
  }
</script>
</body>
</html>

